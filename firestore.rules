
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    match /doctors/{doctorId} {
      allow read, write: if request.auth != null && request.auth.uid == doctorId;
    }

    match /patients/{patientId} {
      // A doctor can GET a patient document if the patient's doctorId matches their own uid.
      allow get: if request.auth != null && request.auth.uid == resource.data.doctorId;
      
      // A doctor can LIST patients. The query must be secured on the client-side.
      allow list: if request.auth != null;
      
      // Allow create/update/delete for authenticated users (doctors)
      allow write: if request.auth != null;
    }
  }
}
