rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Rules for individual document access (get, create, update, delete)
    match /patients/{patientId} {
      // Allow any authenticated user to create a patient.
      allow create: if request.auth != null;

      // Allow read, update, delete only if the user is the assigned doctor.
      allow get, update, delete: if request.auth != null && request.auth.uid == resource.data.doctorUid;
    }

    // Rules for collection-level queries (list)
    match /patients/{document=**} {
        // Allow an authenticated user to list the patients collection.
        // This is needed for the doctor's dashboard.
        // A where() clause should be used in the query to scope this to the doctor's UID for security.
        allow list: if request.auth != null;
    }
  }
}
