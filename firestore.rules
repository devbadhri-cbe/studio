
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /patients/{patientId} {
      // Allow full read/write access for authenticated doctors.
      allow read, write: if request.auth != null;
      
      // Allow unauthenticated patients to read their own document (which is
      // required to then access any subcollections) and update it
      // (to add records). This is secure as it requires the unguessable patient ID.
      allow read, update: if request.auth == null;
    }
  }
}
